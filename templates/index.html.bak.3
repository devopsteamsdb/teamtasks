<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="30">
    <title>לוח משימות DevOps</title>
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-brand">
            <!--<img src="logo.png" alt="DevOps Logo">-->
            <span>לוח משימות DevOps</span>
        </div>
        <div class="navbar-meta">
            <a href="/print" title="גרסת הדפסה"
                style="margin-left:16px;vertical-align:middle;display:inline-block;float:right;">
                <svg width="20" height="20" viewBox="0 0 512 512" fill="#888" style="vertical-align:middle;">
                    <g>
                        <g>
                            <path d="M495.304,144.696h-83.478v-128C411.826,7.475,404.351,0,395.13,0H116.87c-9.22,0-16.696,7.475-16.696,16.696v128H16.696
                                                            C7.475,144.696,0,152.171,0,161.391V395.13c0,9.22,7.475,16.696,16.696,16.696h83.478v83.478c0,9.22,7.475,16.696,16.696,16.696
                                                            H395.13c9.22,0,16.696-7.475,16.696-16.696v-83.478h83.478c9.22,0,16.696-7.475,16.696-16.696V161.391
                                                            C512,152.171,504.525,144.696,495.304,144.696z M133.565,33.391h244.87v111.304h-244.87V33.391z M378.435,478.609h-244.87V311.652
                                                            h244.87V478.609z M478.609,378.435h-66.783v-83.478c0-9.22-7.475-16.696-16.696-16.696H116.87c-9.22,0-16.696,7.475-16.696,16.696
                                                            v83.478H33.391V178.087h83.478H395.13h83.478V378.435z" />
                        </g>
                    </g>
                    <g>
                        <g>
                            <path
                                d="M329.461,346.156H184.765c-9.22,0-16.696,7.475-16.696,16.696s7.475,16.696,16.696,16.696h144.696
                                                            c9.22,0,16.696-7.475,16.696-16.696S338.681,346.156,329.461,346.156z" />
                        </g>
                    </g>
                    <g>
                        <g>
                            <path
                                d="M262.678,412.939h-77.913c-9.22,0-16.696,7.475-16.696,16.696s7.475,16.696,16.696,16.696h77.913
                                                            c9.22,0,16.696-7.475,16.696-16.696S271.899,412.939,262.678,412.939z" />
                        </g>
                    </g>
                    <g>
                        <g>
                            <circle cx="362.852" cy="229.287" r="16.696" />
                        </g>
                    </g>
                    <g>
                        <g>
                            <circle cx="429.635" cy="229.287" r="16.696" />
                        </g>
                    </g>
                </svg>
            </a>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;">
                <circle cx="12" cy="12" r="10" />
                <polyline points="12 6 12 12 16 14" />
            </svg>
            <span id="liveClock" style="padding-right: 1px;"></span>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container">

        <header class="dashboard-header">
            <div class="dashboard-title">
                <!--╫£╫ץ╫ק ╫₧╫⌐╫ש╫₧╫ץ╫¬-->
                <button id="addTaskBtn" class="btn-add-task">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;">
                        <line x1="12" y1="5" x2="12" y2="19" />
                        <line x1="5" y1="12" x2="19" y2="12" />
                    </svg> הוסף משימה
                </button>
            </div>
            <div class="filter-controls">
                <!--<span style="font-size: 0.9rem; color: var(--secondary); margin-left: 0.5rem;">╫í╫ש╫á╫ץ╫ƒ ╫£╫ñ╫ש:</span>-->
                {% set hebrew_names = {'elad': 'אלעד', 'guy': 'גיא', 'itamar': 'איתמר', 'noam': 'נועם', 'david': 'דוד'}
                %}
                {% for member in members %}
                <button class="filter-avatar-btn" data-member="{{ member|lower }}"
                    title="{{ hebrew_names.get(member|lower, member) }}">
                    <img src="{{ url_for('static', filename='images/' + member|lower + '.png') }}"
                        class="filter-avatar">
                </button>
                {% endfor %}
                <!--
                <button class="btn-clear-filter" id="clearFilter">
                    <span style="font-size:1.1em;vertical-align:middle;">Γ£צ∩╕ן</span> ╫á╫º╫פ
                </button>
                -->
            </div>
        </header>

        <div class="projects-grid">
            {% for project in projects %}
            <div class="project-card">
                <div class="project-header">
                    <span class="project-title">
                        <button class="add-task-project-btn" data-project="{{ project }}" title="הוסף משימה לפרויקט זה"
                            style="background:none;border:none;cursor:pointer;padding:0 0 0 6px;vertical-align:middle;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                style="vertical-align:middle;">
                                <line x1="12" y1="5" x2="12" y2="19" />
                                <line x1="5" y1="12" x2="19" y2="12" />
                            </svg>
                        </button>
                        {{ project }}
                    </span>
                    {% set project_colors = [
                    {'bg': '#EEF2FF', 'color': '#4F46E5'},
                    {'bg': '#ECFDF5', 'color': '#10B981'},
                    {'bg': '#FFF7ED', 'color': '#F97316'},
                    {'bg': '#FEF2F2', 'color': '#EF4444'},
                    {'bg': '#F0F9FF', 'color': '#0EA5E9'},
                    {'bg': '#FDF2FF', 'color': '#A21CAF'},
                    {'bg': '#F1F5F9', 'color': '#0F172A'},
                    {'bg': '#FFFBEB', 'color': '#CA8A04'},
                    {'bg': '#E0F2FE', 'color': '#0369A1'},
                    {'bg': '#F3F4F6', 'color': '#7C3AED'},
                    {'bg': '#FDE68A', 'color': '#B45309'},
                    {'bg': '#D1FAE5', 'color': '#047857'},
                    {'bg': '#FECACA', 'color': '#B91C1C'},
                    {'bg': '#EDE9FE', 'color': '#7C3AED'},
                    {'bg': '#C7D2FE', 'color': '#1D4ED8'}
                    ] %}
                    {# Priority colors: high=red, medium=orange, low=yellow, none/empty=gray #}
                    {% set priority_colors = {
                    'high': '#ef4444',
                    'medium': '#f59e0b',
                    'low': '#fde047',
                    'none': '#cbd5e1',
                    '': '#cbd5e1'
                    } %}
                    {% set color = project_colors[(loop.index0) % project_colors|length] %}
                    <span class="project-badge"
                        style="background-color: {{ color.bg }}; color: {{ color.color }};">פרויקט {{ loop.index
                        }}</span>
                </div>
                <div class="project-body">
                    <ul class="task-list">
                        {% for task in tasks if task.project == project %}
                        <li class="task-item" data-id="{{ task.id }}" data-notes="{{ task.notes|default('') }}"
                            data-priority="{{ task.priority|default('none') }}">
                            <div class="task-info">
                                <span class="task-marker"
                                    style="background-color: {{ priority_colors.get(task.priority, '#cbd5e1') }};"></span>
                                <span class="task-name">{{ task.task }}</span>
                                <span class="note-icon{% if not task.notes %} hidden{% endif %}" title="קיים הערות"
                                    style="vertical-align:middle;">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="4" y="4" width="16" height="16" rx="2" />
                                        <line x1="8" y1="8" x2="16" y2="8" />
                                        <line x1="8" y1="12" x2="16" y2="12" />
                                        <line x1="8" y1="16" x2="12" y2="16" />
                                    </svg>
                                </span>
                            </div>
                            <div class="task-actions">
                                <button class="btn-icon edit-btn" title="ערוך"></button>
                            </div>
                            <div class="task-meta">
                                <div class="avatar-group">
                                    {% set member_list = task.members.split(',') if task.members else [] %}
                                    {% set hebrew_names = {'elad': 'אלעד', 'guy': 'גיא', 'itamar': 'איתמר', 'noam':
                                    'נועם', 'david': 'דוד'} %}
                                    {% for member in member_list %}
                                    {% set member_key = member|lower|trim %}
                                    {% if member_key %}
                                    <img src="{{ url_for('static', filename='images/' + member_key + '.png') }}"
                                        class="avatar" title="{{ hebrew_names.get(member_key, member) }}">
                                    {% endif %}
                                    {% endfor %}
                                </div>
                                <span class="status-badge {{ task.status }}">{{ task.status|replace('status-inprogress',
                                    'בתהליך')|replace('status-done', 'הושלם')|replace('status-notstarted', 'לא
                                    החל')|replace('status-delayed', 'מעוכב') }}</span>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endfor %}
        </div>



        <!-- Create Task Modal -->
        <div id="createTaskModal" class="modal">
            <div class="modal-content">
                <span class="close-modal-create">&times;</span>
                <h2 id="createModalTitle">יצירת משימה חדשה</h2>
                <div class="form-group">
                    <label for="createProjectNameInput">שם הפרויקט:</label>
                    <input type="text" id="createProjectNameInput" class="form-control">
                </div>
                <div class="form-group">
                    <label for="createTaskNameInput">שם המשימה:</label>
                    <input type="text" id="createTaskNameInput" class="form-control">
                </div>
                <div class="form-group">
                    <label>חברי צוות:</label>
                    <div class="members-select">
                        <!-- Populated dynamically by JavaScript -->
                    </div>
                </div>
                <div class="form-group">
                    <label for="createTaskTeam">צוות:</label>
                    <select id="createTaskTeam" class="form-control">
                        <!-- Populated dynamically by JavaScript -->
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group half">
                        <label for="createTaskStatus">סטטוס:</label>
                        <select id="createTaskStatus" class="form-control">
                            <option value="status-inprogress">בתהליך</option>
                            <option value="status-done">הושלם</option>
                            <option value="status-notstarted">לא החל</option>
                            <option value="status-delayed">מעוכב</option>
                        </select>
                    </div>
                    <div class="form-group half">
                        <label for="createTaskPriority">עדיפות:</label>
                        <select id="createTaskPriority" class="form-control">
                            <option value="none">ללא</option>
                            <option value="low">נמוכה</option>
                            <option value="medium">בינונית</option>
                            <option value="high">גבוהה</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="createTaskNotes">הערות:</label>
                    <textarea id="createTaskNotes" rows="4" placeholder="הוסף הערות כאן..."></textarea>
                </div>
                <div class="modal-actions">
                    <button id="createSaveBtn" class="btn btn-primary">צור משימה</button>
                </div>
            </div>
        </div>

        <!-- Edit Task Modal -->
        <div id="taskModal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2 id="modalTitle">עריכת משימה</h2>
                <div class="form-group">
                    <label for="projectNameInput">שם הפרויקט:</label>
                    <input type="text" id="projectNameInput" class="form-control">
                </div>
                <div class="form-group">
                    <label for="taskNameInput">שם המשימה:</label>
                    <input type="text" id="taskNameInput" class="form-control">
                </div>
                <div class="form-group">
                    <label>חברי צוות:</label>
                    <div class="members-select">
                        <!-- Populated dynamically by JavaScript -->
                    </div>
                </div>
                <div class="form-group">
                    <label for="taskTeam">צוות:</label>
                    <select id="taskTeam" class="form-control">
                        <!-- Populated dynamically by JavaScript -->
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group half">
                        <label for="taskStatus">סטטוס:</label>
                        <select id="taskStatus" class="form-control">
                            <option value="status-inprogress">בתהליך</option>
                            <option value="status-done">הושלם</option>
                            <option value="status-notstarted">לא החל</option>
                            <option value="status-delayed">מעוכב</option>
                        </select>
                    </div>
                    <div class="form-group half">
                        <label for="taskPriority">עדיפות:</label>
                        <select id="taskPriority" class="form-control">
                            <option value="none">ללא</option>
                            <option value="low">נמוכה</option>
                            <option value="medium">בינונית</option>
                            <option value="high">גבוהה</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="taskNotes">הערות:</label>
                    <textarea id="taskNotes" rows="4" placeholder="הוסף הערות כאן..."></textarea>
                </div>
                <div class="modal-actions">
                    <button id="saveBtn" class="btn btn-primary">שמור שינויים</button>
                    <button id="deleteBtn" class="btn btn-danger">מחק משימה</button>
                </div>
            </div>
        </div>

        <script src="{{ url_for('static', filename='script.js') }}"></script>
        <script>
            // Add-task-per-project button logic
            document.addEventListener('DOMContentLoaded', function () {
                document.querySelectorAll('.add-task-project-btn').forEach(function (btn) {
                    btn.addEventListener('click', function (e) {
                        e.stopPropagation();
                        var projectName = btn.getAttribute('data-project');
                        var modal = document.getElementById('createTaskModal');
                        var projectInput = document.getElementById('createProjectNameInput');
                        if (projectInput) projectInput.value = projectName;
                        // Clear other fields
                        var nameInput = document.getElementById('createTaskNameInput');
                        if (nameInput) nameInput.value = '';
                        var statusInput = document.getElementById('createTaskStatus');
                        if (statusInput) statusInput.value = 'status-inprogress';
                        var priorityInput = document.getElementById('createTaskPriority');
                        if (priorityInput) priorityInput.value = 'none';
                        var notesInput = document.getElementById('createTaskNotes');
                        if (notesInput) notesInput.value = '';
                        document.querySelectorAll('#createTaskModal .members-select input[type="checkbox"]').forEach(function (cb) { cb.checked = false; });
                        modal.style.display = 'block';
                        modal.style.zIndex = 2000;
                        modal.style.visibility = 'visible';
                    });
                });
            });
        </script>
</body>

<script>
    // Live clock for navbar
    function updateClock() {
        const now = new Date();
        const day = String(now.getDate()).padStart(2, '0');
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const year = now.getFullYear();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        // Format: dd/mm/yyyy hh:mm:ss
        const formatted = `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
        const el = document.getElementById('liveClock');
        if (el) el.textContent = ` ${formatted} `;
    }
    setInterval(updateClock, 1000);
    updateClock();
</script>
</body>

</html>
