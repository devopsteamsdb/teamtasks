<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>לוח שנה - תכנון צוות</title>
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='calendar.css') }}" rel="stylesheet">
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="/" class="navbar-brand-link" id="navTasksLink"><span>לוח משימות</span></a>
            <a href="/calendar" class="navbar-brand-link active" id="navCalendarLink"><span>לוח שנה</span></a>
        </div>

        <!-- Team Filter Buttons -->
        <div class="team-filter-group">
            {% for team in teams %}
            <button class="filter-team-btn" data-team-id="{{ team.id }}">
                {{ team.name_he }}
            </button>
            {% endfor %}
            <button class="filter-team-btn archive-filter-btn" data-team-id="archive"
                style="border: 2px solid #ef4444; color: #ef4444;">
                <img src="{{ url_for('static', filename='icons/archive.svg') }}" width="14" height="14"
                    style="vertical-align: middle; filter: brightness(0) invert(0.4);"> ארכיון
            </button>
        </div>

        <div class="navbar-meta">
            <a href="/admin" title="ממשק ניהול" class="navbar-icon-link">
                <img src="{{ url_for('static', filename='icons/settings.svg') }}" width="20" height="20" alt="Settings"
                    class="icon-img">
            </a>
            <a href="/print" title="גרסת הדפסה" class="navbar-icon-link print-link">
                <img src="{{ url_for('static', filename='icons/print.svg') }}" width="20" height="20" alt="Print"
                    class="icon-img">
            </a>

            <span style="padding-right: 1px;">{{ now.strftime('%d/%m/%Y') }}</span>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container">

        <header class="calendar-header">
            <div class="calendar-controls">
                <button id="prevPeriod" class="btn-nav">שבוע קודם</button>
                <h2 id="periodTitle" class="period-title"></h2>
                <button id="nextPeriod" class="btn-nav">שבוע הבא</button>
                <button id="todayBtn" class="btn-today">השבוע הזה</button>
            </div>

            <div class="calendar-controls">
                <div class="view-toggle">
                    <button class="view-btn active" data-view="week">שבוע</button>
                    <button class="view-btn" data-view="workload">חברי צוות</button>
                </div>
                <button id="manageHolidaysBtn" class="btn-nav" style="background-color: #f59e0b; margin-right: 1rem;"
                    title="ניהול ימים מיוחדים">
                    <img src="{{ url_for('static', filename='icons/star.svg') }}" width="16" height="16"
                        style="vertical-align: middle;">
                </button>
            </div>
        </header>

        <!-- Calendar Container -->
        <div id="calendarContainer" class="calendar-container">
            <!-- Week View (default) -->
            <div id="weekView" class="calendar-view active">
                <div class="calendar-week-grid">
                    <!-- Days will be populated by JavaScript -->
                </div>
            </div>

            <!-- Workload View -->
            <div id="workloadView" class="calendar-view">
                <div class="workload-container">
                    <!-- Workload timeline will be populated by JavaScript -->
                </div>
            </div>
        </div>

    </div>

    <!-- Task Schedule Modal -->
    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="scheduleModalTitle">עריכת תזמון משימה</h2>
            <div class="form-group">
                <label for="scheduleTaskName">שם המשימה:</label>
                <input type="text" id="scheduleTaskName" class="form-control" readonly>
            </div>
            <div class="form-row">
                <div class="form-group half">
                    <label for="scheduleStartDate">תאריך התחלה:</label>
                    <input type="text" id="scheduleStartDate" class="form-control" placeholder="dd/mm/yyyy">
                </div>
                <div class="form-group half">
                    <label for="scheduleEndDate">תאריך סיום:</label>
                    <input type="text" id="scheduleEndDate" class="form-control" placeholder="dd/mm/yyyy">
                </div>
            </div>
            <div class="modal-actions">
                <button id="scheduleSaveBtn" class="btn btn-primary">שמור שינויים</button>
                <button id="scheduleCancelBtn" class="btn btn-secondary">ביטול</button>
            </div>
        </div>
    </div>

    <!-- Edit Task Modal (Full) -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="modalTitle">עריכת משימה</h2>
            <div class="form-group">
                <label for="taskTeam">צוות:</label>
                <select id="taskTeam" class="form-control">
                    <!-- Populated dynamically by JavaScript -->
                </select>
            </div>
            <div class="form-group">
                <label for="projectNameInput">שם הפרויקט:</label>
                <input type="text" id="projectNameInput" class="form-control">
            </div>
            <div class="form-group">
                <label for="taskNameInput">שם המשימה:</label>
                <input type="text" id="taskNameInput" class="form-control">
            </div>
            <div class="form-group">
                <label>חברי צוות:</label>
                <div class="members-select">
                    <!-- Populated dynamically by JavaScript -->
                </div>
            </div>
            <div class="form-row">
                <div class="form-group half">
                    <label for="taskStatus">סטטוס:</label>
                    <select id="taskStatus" class="form-control">
                        <option value="status-notstarted">טרם החל</option>
                        <option value="status-inprogress">בתהליך</option>
                        <option value="status-done">הושלם</option>
                        <option value="status-delayed">מעוכב</option>
                    </select>
                </div>
                <div class="form-group half">
                    <label for="taskPriority">עדיפות:</label>
                    <select id="taskPriority" class="form-control">
                        <option value="none">ללא</option>
                        <option value="low">נמוכה</option>
                        <option value="medium">בינונית</option>
                        <option value="high">גבוהה</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group half">
                    <label for="taskStartDate">תאריך התחלה (אופציונלי):</label>
                    <input type="text" id="taskStartDate" class="form-control" placeholder="dd/mm/yyyy">
                </div>
                <div class="form-group half">
                    <label for="taskEndDate">תאריך סיום (אופציונלי):</label>
                    <input type="text" id="taskEndDate" class="form-control" placeholder="dd/mm/yyyy">
                </div>
            </div>
            <div class="form-group">
                <label for="taskNotes">הערות:</label>
                <textarea id="taskNotes" rows="4" placeholder="הוסף הערות כאן..."></textarea>
            </div>
            <div class="modal-actions">
                <button id="saveBtn" class="btn btn-primary">שמור שינויים</button>
                <button id="deleteBtn" class="btn btn-danger">מחק משימה</button>
            </div>
        </div>
    </div>

    <!-- Special Days Management Modal -->
    <div id="specialDaysModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close-modal">&times;</span>
            <h2>ניהול ימים מיוחדים</h2>

            <div class="special-days-form-container"
                style="background: #f9fafb; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <h3>הוסף יום מיוחד</h3>
                <div class="form-row" style="align-items: flex-end;">
                    <div class="form-group" style="flex: 1;">
                        <label>תאריך:</label>
                        <input type="text" id="specialDayDate" class="form-control" placeholder="dd/mm/yyyy">
                    </div>
                    <div class="form-group" style="flex: 2;">
                        <label>שם:</label>
                        <input type="text" id="specialDayName" class="form-control" placeholder="חג / אירוע">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>סוג:</label>
                        <select id="specialDayType" class="form-control">
                            <option value="holiday">חג</option>
                            <option value="company_event">אירוע חברה</option>
                            <option value="other">אחר</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <button id="addSpecialDayBtn" class="btn btn-primary">הוסף</button>
                    </div>
                </div>
            </div>

            <div class="special-days-list-container">
                <h3>רשימת ימים מיוחדים</h3>
                <div id="specialDaysList" style="max-height: 300px; overflow-y: auto;">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="{{ url_for('static', filename='js/calendar/main.js') }}"></script>
    </script>
</body>

</html>