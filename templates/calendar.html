<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>לוח שנה - תכנון צוות</title>
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='calendar.css') }}" rel="stylesheet">
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="/" class="navbar-brand-link"><span>לוח משימות</span></a>
            <a href="/calendar" class="navbar-brand-link active"><span>לוח שנה</span></a>
        </div>

        <!-- Team Filter Buttons -->
        <div class="team-filter-group">
            {% for team in teams %}
            <button class="filter-team-btn" data-team-id="{{ team.id }}">
                {{ team.name_he }}
            </button>
            {% endfor %}
        </div>

        <div class="navbar-meta">
            <a href="/admin" title="ממשק ניהול" class="navbar-icon-link">
                <img src="{{ url_for('static', filename='icons/settings.svg') }}" width="20" height="20" alt="Settings"
                    class="icon-img">
            </a>
            <a href="/print" title="גרסת הדפסה" class="navbar-icon-link print-link">
                <img src="{{ url_for('static', filename='icons/print.svg') }}" width="20" height="20" alt="Print"
                    class="icon-img">
            </a>
            <img src="{{ url_for('static', filename='icons/clock.svg') }}" width="18" height="18" alt="Clock"
                class="icon-img">
            <span id="liveClock" style="padding-right: 1px;"></span>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container">

        <header class="calendar-header">
            <div class="calendar-controls">
                <button id="prevPeriod" class="btn-nav">שבוע קודם</button>
                <h2 id="periodTitle" class="period-title"></h2>
                <button id="nextPeriod" class="btn-nav">שבוע הבא</button>
                <button id="todayBtn" class="btn-today">השבוע הזה</button>
            </div>

            <div class="calendar-controls">
                <div class="view-toggle">
                    <button class="view-btn active" data-view="week">שבוע</button>
                    <button class="view-btn" data-view="workload">חברי צוות</button>
                </div>
                <button id="manageHolidaysBtn" class="btn-nav" style="background-color: #f59e0b; margin-right: 1rem;"
                    title="ניהול ימים מיוחדים">
                    <img src="{{ url_for('static', filename='icons/star.svg') }}" width="16" height="16"
                        style="vertical-align: middle;">
                </button>
            </div>
        </header>

        <!-- Calendar Container -->
        <div id="calendarContainer" class="calendar-container">
            <!-- Week View (default) -->
            <div id="weekView" class="calendar-view active">
                <div class="calendar-week-grid">
                    <!-- Days will be populated by JavaScript -->
                </div>
            </div>

            <!-- Workload View -->
            <div id="workloadView" class="calendar-view">
                <div class="workload-container">
                    <!-- Workload timeline will be populated by JavaScript -->
                </div>
            </div>
        </div>

    </div>

    <!-- Task Schedule Modal -->
    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="scheduleModalTitle">עריכת תזמון משימה</h2>
            <div class="form-group">
                <label for="scheduleTaskName">שם המשימה:</label>
                <input type="text" id="scheduleTaskName" class="form-control" readonly>
            </div>
            <div class="form-row">
                <div class="form-group half">
                    <label for="scheduleStartDate">תאריך התחלה:</label>
                    <input type="text" id="scheduleStartDate" class="form-control" placeholder="dd/mm/yyyy">
                </div>
                <div class="form-group half">
                    <label for="scheduleEndDate">תאריך סיום:</label>
                    <input type="text" id="scheduleEndDate" class="form-control" placeholder="dd/mm/yyyy">
                </div>
            </div>
            <div class="modal-actions">
                <button id="scheduleSaveBtn" class="btn btn-primary">שמור שינויים</button>
                <button id="scheduleCancelBtn" class="btn btn-secondary">ביטול</button>
            </div>
        </div>
    </div>

    <!-- Special Days Management Modal -->
    <div id="specialDaysModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close-modal">&times;</span>
            <h2>ניהול ימים מיוחדים</h2>

            <div class="special-days-form-container"
                style="background: #f9fafb; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <h3>הוסף יום מיוחד</h3>
                <div class="form-row" style="align-items: flex-end;">
                    <div class="form-group" style="flex: 1;">
                        <label>תאריך:</label>
                        <input type="text" id="specialDayDate" class="form-control" placeholder="dd/mm/yyyy">
                    </div>
                    <div class="form-group" style="flex: 2;">
                        <label>שם:</label>
                        <input type="text" id="specialDayName" class="form-control" placeholder="חג / אירוע">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>סוג:</label>
                        <select id="specialDayType" class="form-control">
                            <option value="holiday">חג</option>
                            <option value="company_event">אירוע חברה</option>
                            <option value="other">אחר</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <button id="addSpecialDayBtn" class="btn btn-primary">הוסף</button>
                    </div>
                </div>
            </div>

            <div class="special-days-list-container">
                <h3>רשימת ימים מיוחדים</h3>
                <div id="specialDaysList" style="max-height: 300px; overflow-y: auto;">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='calendar.js') }}"></script>
    <script>
        // Live clock for navbar
        function updateClock() {
            const now = new Date();
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const year = now.getFullYear();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            const formatted = `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
            const el = document.getElementById('liveClock');
            if (el) el.textContent = ` ${formatted} `;
        }
        setInterval(updateClock, 1000);
        updateClock();
    </script>
</body>

</html>