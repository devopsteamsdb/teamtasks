<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 砖 - 转 爪转</title>
    <link href="{{ url_for('static', filename='flatpickr.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='calendar.css') }}" rel="stylesheet">
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
</head>

<body>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="/" class="navbar-brand-link" id="navTasksLink"><span> 砖转</span></a>
            <a href="/calendar" class="navbar-brand-link active" id="navCalendarLink"><span> 砖</span></a>
        </div>

        <!-- Team Filter Buttons -->
        <div class="team-filter-group">
            {% for team in teams %}
            <button class="filter-team-btn" data-team-id="{{ team.id }}">
                {{ team.name_he }}
            </button>
            {% endfor %}
            <button class="filter-team-btn archive-filter-btn" data-team-id="archive"
                style="border: 2px solid #ef4444; color: #ef4444;">
                <img src="{{ url_for('static', filename='icons/archive.svg') }}" width="14" height="14"
                    style="vertical-align: middle; filter: brightness(0) invert(0.4);"> 专
            </button>
        </div>

        <div class="navbar-meta">
            <a href="/table-editor" class="navbar-icon-link" title="注专 ">
                <img src="{{ url_for('static', filename='icons/table.svg') }}" width="20" height="20" alt="Table Editor"
                    class="icon-img">
            </a>
            <a href="/admin" title="砖拽 " class="navbar-icon-link">
                <img src="{{ url_for('static', filename='icons/settings.svg') }}" width="20" height="20" alt="Settings"
                    class="icon-img">
            </a>
            <a href="/print" title="专住转 驻住" class="navbar-icon-link print-link">
                <img src="{{ url_for('static', filename='icons/print.svg') }}" width="20" height="20" alt="Print"
                    class="icon-img">
            </a>
            <button id="themeToggleBtn" title="爪 " class="navbar-icon-link"
                style="background:none; border:none; cursor:pointer; font-size:1.2rem; padding: 0 0.5rem;"></button>

            <span style="padding-right: 1px;">{{ now.strftime('%d/%m/%Y') }}</span>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-container">

        <header class="calendar-header">
            <div class="calendar-controls">
                <button id="prevPeriod" class="btn-nav">砖注 拽</button>
                <h2 id="periodTitle" class="period-title"></h2>
                <button id="nextPeriod" class="btn-nav">砖注 </button>
                <button id="todayBtn" class="btn-today">砖注 </button>
            </div>

            <div class="calendar-controls">
                <div class="view-toggle">
                    <button class="view-btn active" data-view="week">砖注</button>
                    <button class="view-btn" data-view="workload">专 爪转</button>
                </div>
                <button id="manageHolidaysBtn" class="btn-nav" style="background-color: #f59e0b; margin-right: 1rem;"
                    title="  ">
                    <img src="{{ url_for('static', filename='icons/star.svg') }}" width="16" height="16"
                        style="vertical-align: middle;">
                </button>
            </div>
        </header>

        <!-- Calendar Container -->
        <div id="calendarContainer" class="calendar-container">
            <!-- Week View (default) -->
            <div id="weekView" class="calendar-view active">
                <div class="calendar-week-grid">
                    <!-- Days will be populated by JavaScript -->
                </div>
            </div>

            <!-- Workload View -->
            <div id="workloadView" class="calendar-view">
                <div class="workload-container">
                    <!-- Workload timeline will be populated by JavaScript -->
                </div>
            </div>
        </div>

    </div>

    <!-- Task Schedule Modal -->
    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="scheduleModalTitle">注专转 转 砖</h2>
            <div class="form-group">
                <label for="scheduleTaskName">砖 砖:</label>
                <input type="text" id="scheduleTaskName" class="form-control" readonly>
            </div>
            <div class="form-row">
                <div class="form-group half">
                    <label for="scheduleStartDate">转专 转:</label>
                    <input type="text" id="scheduleStartDate" class="form-control" placeholder="dd/mm/yyyy">
                </div>
                <div class="form-group half">
                    <label for="scheduleEndDate">转专 住:</label>
                    <input type="text" id="scheduleEndDate" class="form-control" placeholder="dd/mm/yyyy">
                </div>
            </div>
            <div class="modal-actions">
                <button id="scheduleSaveBtn" class="btn btn-primary">砖专 砖</button>
                <button id="scheduleCancelBtn" class="btn btn-secondary"></button>
            </div>
        </div>
    </div>

    <!-- Edit Task Modal (Full) -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="modalTitle">注专转 砖</h2>
            <div class="form-group">
                <label for="taskTeam">爪转:</label>
                <select id="taskTeam" class="form-control">
                    <!-- Populated dynamically by JavaScript -->
                </select>
            </div>
            <div class="form-group">
                <label for="projectNameInput">砖 驻专拽:</label>
                <input type="text" id="projectNameInput" class="form-control">
            </div>
            <div class="form-group">
                <label for="taskNameInput">砖 砖:</label>
                <input type="text" id="taskNameInput" class="form-control">
            </div>
            <div class="form-group">
                <label>专 爪转:</label>
                <div class="members-select">
                    <!-- Populated dynamically by JavaScript -->
                </div>
            </div>
            <div class="form-row">
                <div class="form-group half">
                    <label for="taskStatus">住住:</label>
                    <select id="taskStatus" class="form-control">
                        <option value="status-notstarted">专 </option>
                        <option value="status-inprogress">转</option>
                        <option value="status-done">砖</option>
                        <option value="status-delayed">注</option>
                    </select>
                </div>
                <div class="form-group half">
                    <label for="taskPriority">注驻转:</label>
                    <select id="taskPriority" class="form-control">
                        <option value="none"></option>
                        <option value="low"></option>
                        <option value="medium">转</option>
                        <option value="high"></option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group half">
                    <label for="taskStartDate">转专 转 (驻爪):</label>
                    <input type="text" id="taskStartDate" class="form-control" placeholder="dd/mm/yyyy">
                </div>
                <div class="form-group half">
                    <label for="taskEndDate">转专 住 (驻爪):</label>
                    <input type="text" id="taskEndDate" class="form-control" placeholder="dd/mm/yyyy">
                </div>
            </div>
            <div class="form-group">
                <label for="taskNotes">注专转:</label>
                <textarea id="taskNotes" rows="4" placeholder="住祝 注专转 ..."></textarea>
            </div>
            <div class="modal-actions">
                <button id="saveBtn" class="btn btn-primary">砖专 砖</button>
                <button id="deleteBtn" class="btn btn-danger">拽 砖</button>
            </div>
        </div>
    </div>

    <!-- Special Days Management Modal -->
    <div id="specialDaysModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close-modal">&times;</span>
            <h2>  </h2>

            <div class="special-days-form-container"
                style="background: #f9fafb; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <h3>住祝  </h3>
                <div class="form-row" style="align-items: flex-end;">
                    <div class="form-group" style="flex: 1;">
                        <label>转专:</label>
                        <input type="text" id="specialDayDate" class="form-control" placeholder="dd/mm/yyyy">
                    </div>
                    <div class="form-group" style="flex: 2;">
                        <label>砖:</label>
                        <input type="text" id="specialDayName" class="form-control" placeholder=" / 专注">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>住:</label>
                        <select id="specialDayType" class="form-control">
                            <option value="holiday"></option>
                            <option value="company_event">专注 专</option>
                            <option value="other">专</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <button id="addSpecialDayBtn" class="btn btn-primary">住祝</button>
                    </div>
                </div>
            </div>

            <div class="special-days-list-container">
                <h3>专砖转  </h3>
                <div id="specialDaysList" style="max-height: 300px; overflow-y: auto;">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='flatpickr.min.js') }}"></script>
    <script src="{{ url_for('static', filename='flatpickr.he.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/calendar/main.js') }}"></script>
    </script>
</body>

</html>